<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CarFlix Dashboard</title>
  <link href="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js"></script>
  <style>
    * { margin:0; box-sizing:border-box; }
    body {
      font-family: "Segoe UI", sans-serif;
      background: #000; color: white; height: 100vh;
      display: flex; flex-direction: column;
    }
    header, footer {
      padding: 12px 20px;
      background: #1a1a1a;
      color: #4cd964;
      font-size: 1.2rem;
    }
    #content {
      flex: 1; display: flex;
      overflow: hidden;
    }
    #appDrawer {
      width: 80px; background: #111;
      display: flex; flex-direction: column;
      align-items: center; padding-top: 12px;
      border-right: 2px solid #333;
    }
    .app-btn {
      background: none; border: none;
      color: white; font-size: 1.6rem;
      margin: 14px 0; cursor: pointer;
    }
    .app-btn.active { color: #4cd964; }

    #main {
      flex: 1; display: flex;
      position: relative;
    }
    #sidebar {
      width: 280px; background: #1a1a1a;
      padding: 16px; overflow-y: auto;
      display: flex; flex-direction: column;
    }
    #sidebar input, #sidebar button {
      font-size: 1rem; margin-bottom: 8px;
      padding: 10px; border-radius: 10px;
      border: none;
    }
    #sidebar input {
      background: #333; color: white;
    }
    #sidebar button {
      background: #4cd964; color: black;
      font-weight: bold; cursor: pointer;
    }

    #map, #musicPanel {
      flex: 1; height: 100%;
    }

    #musicPanel {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: black;
      color: white;
    }

    #trackInfo {
      margin-bottom: 12px;
      font-size: 1.1rem;
    }

    .ctrl {
      background: #4cd964;
      color: black;
      border: none;
      padding: 10px 16px;
      font-size: 1rem;
      margin: 4px;
      border-radius: 8px;
      cursor: pointer;
    }

    footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <header>üöò CarFlix Dashboard</header>
  <div id="content">
    <div id="appDrawer">
      <button class="app-btn active" id="mapBtn" onclick="showApp('map')">üó∫Ô∏è</button>
      <button class="app-btn" id="musicBtn" onclick="showApp('music')">üéµ</button>
    </div>
    <div id="main">
      <div id="sidebar">
        <input id="from" placeholder="From..." />
        <input id="to" placeholder="To..." />
        <button onclick="startRoute()">üß≠ Start</button>
        <button onclick="useCurrentLocation()">üìç Current Location</button>
        <button onclick="simulate()">‚ñ∂Ô∏è Play</button>
        <button onclick="pauseRoute()">‚è∏Ô∏è Pause</button>
        <button onclick="stopRoute()">‚èπÔ∏è Stop</button>
        <div id="info">Distance info</div>
      </div>
      <div id="map"></div>
      <div id="musicPanel">
        <div id="trackInfo">üîí Please login to Spotify</div>
        <button id="spotifyLoginBtn" class="ctrl" onclick="loginToSpotify()">Login to Spotify</button>
        <div id="playerControls" style="display: none;">
          <button class="ctrl" onclick="prevTrack()">‚èÆÔ∏è</button>
          <button class="ctrl" onclick="togglePlay()">‚ñ∂Ô∏è/‚è∏Ô∏è</button>
          <button class="ctrl" onclick="nextTrack()">‚è≠Ô∏è</button>
        </div>
      </div>
    </div>
  </div>
  <footer>
    <span id="clock">üïí --:--</span>
    <span>¬© CarFlix</span>
  </footer>

<script>
  const clientId = "71fd3483d4b44d55b927ffbafd4954c4";
  const redirectUri = window.location.origin + window.location.pathname;
  const scopes = "streaming user-read-email user-read-private user-modify-playback-state user-read-playback-state";

  let spotifyToken = null;
  let player = null, deviceId = null;

  window.onSpotifyWebPlaybackSDKReady = () => {
    player = new Spotify.Player({
      name: "CarFlix Music",
      getOAuthToken: cb => cb(spotifyToken),
    });

    player.addListener("ready", ({ device_id }) => {
      deviceId = device_id;
      document.getElementById("trackInfo").innerText = "üé∂ Spotify Ready";
      document.getElementById("spotifyLoginBtn").style.display = "none";
      document.getElementById("playerControls").style.display = "flex";
    });

    player.addListener("player_state_changed", state => {
      if (state) {
        const track = state.track_window.current_track;
        document.getElementById("trackInfo").innerText = `üéµ ${track.name} ‚Äì ${track.artists.map(a => a.name).join(", ")}`;
      }
    });

    player.connect();
  };

  function loginToSpotify() {
    const url = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}`;
    window.location = url;
  }

  window.onload = () => {
    const hash = new URLSearchParams(window.location.hash.substr(1));
    if (hash.get("access_token")) {
      spotifyToken = hash.get("access_token");
      window.location.hash = "";
      if (typeof onSpotifyWebPlaybackSDKReady === 'function') onSpotifyWebPlaybackSDKReady();
    }
    updateClock();
    setInterval(updateClock, 1000);
  };

  function updateClock() {
    const now = new Date();
    document.getElementById("clock").innerText =
      "üïí " + now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  }

  function showApp(app) {
    const mapBtn = document.getElementById("mapBtn");
    const musicBtn = document.getElementById("musicBtn");
    document.getElementById("map").style.display = app === "map" ? "block" : "none";
    document.getElementById("sidebar").style.display = app === "map" ? "flex" : "none";
    document.getElementById("musicPanel").style.display = app === "music" ? "flex" : "none";
    mapBtn.classList.toggle("active", app === "map");
    musicBtn.classList.toggle("active", app === "music");

    if (app === "music" && spotifyToken && !player) onSpotifyWebPlaybackSDKReady();
  }

  function togglePlay() { if (player) player.togglePlay(); }
  function nextTrack() { if (player) player.nextTrack(); }
  function prevTrack() { if (player) player.previousTrack(); }

  // -- MAP SETUP OMITTED FOR BREVITY --
  function startRoute() {} function useCurrentLocation() {}
  function simulate() {} function pauseRoute() {}
  function stopRoute() {}
</script>
<script src="https://sdk.scdn.co/spotify-player.js"></script>
</body>
</html>
